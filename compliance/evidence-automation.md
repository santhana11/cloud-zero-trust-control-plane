# Evidence Automation (Phase 8)

**Purpose:** Explain how we **automate** the collection and availability of compliance **evidence** so auditors and internal teams can rely on continuous or on-demand proof instead of one-off manual exports.

---

## 1. Why Automate Evidence

- **Continuous:** Evidence reflects current state (e.g. Config compliance, GuardDuty enabled) rather than a point-in-time screenshot.
- **Repeatable:** Same process every time; less human error and consistent format for audit.
- **Faster:** No manual “export and attach” for every control; evidence is already in a known place or pipeline artifact.
- **Traceable:** Code and CI define what is collected; changes are versioned and reviewable.

---

## 2. What We Automate

| Evidence type | What it proves | How it’s automated | Where it lives |
|---------------|----------------|--------------------|----------------|
| **AWS Config compliance** | Resources conform to rules (e.g. EBS encrypted, S3 not public) | Config recorder + rules in Terraform; continuous evaluation | Config console, Config aggregator, optional export to S3 |
| **GuardDuty enabled** | Threat detection is on | Terraform deploys GuardDuty; Org delegation | GuardDuty console, Terraform state |
| **GuardDuty findings / response** | Threats detected and contained | EventBridge → Lambda (quarantine, snapshot, SNS); runbooks | GuardDuty, CloudWatch Logs, SNS, runbooks in repo |
| **Terraform state vs live (no drift)** | Infra matches code | Nightly `terraform plan -detailed-exitcode`; exit 2 = drift | CI artifact (plan), Slack; see `../ci-cd/github-actions/terraform-drift.yml` |
| **IaC and policy checks** | Terraform and K8s meet policy (no public S3, encryption, etc.) | Conftest (OPA), Checkov, in CI on every PR/push | CI logs, Conftest/Checkov output; policy in repo |
| **SBOM and CVE posture** | We know what’s in images and gate on critical/high | Syft SBOM, Trivy scan, fail on CRITICAL/HIGH in CI | GitHub Actions artifacts (SBOM, scan results), optional S3 |
| **Image signing** | Only signed images deployable (when admission is on) | Cosign in CI; Kyverno verifyImages in cluster | Registry, CI logs, Kyverno PolicyReport |
| **Access and change audit** | Who did what, when | CloudTrail (SCP prevents deletion); IAM AssumeRole, API calls | CloudTrail, S3/CloudWatch Logs (if exported) |
| **Control as code** | SCPs, permission boundary, Config rules, K8s policies | All in Terraform and Kubernetes YAML in repo | Git history, Terraform state, applied in accounts/cluster |

---

## 3. How It Works End-to-End

1. **Define in code:** Controls are implemented in Terraform (Config, GuardDuty, SCPs, IAM), Kubernetes (Kyverno, network policy), and CI (Conftest, Checkov, Trivy, Syft, drift workflow). No “manual checklist” for those controls—the code and its apply are the implementation.
2. **Run continuously or on trigger:** Config and GuardDuty evaluate continuously. CI runs on every PR/push (policy and scan) and on schedule (drift). Evidence is either always up to date (Config dashboard, GuardDuty) or produced every run (artifacts, logs).
3. **Store in known places:** Evidence lives in AWS (Config, GuardDuty, CloudTrail), GitHub (artifacts, workflow runs), and the repo (runbooks, policy, Terraform). We document “where to look” in the scorecard and CIS mapping.
4. **Export when needed:** For audit, we pull from those same places: Config compliance report, GuardDuty findings export, CloudTrail query, download of SBOM/drift plan artifacts. Automation doesn’t replace export—it ensures the **source** of the export is current and consistent.

---

## 4. What Stays Manual (or Semi-Automated)

- **IdP/SSO configuration:** MFA and password policy are often in IdP; evidence may be screenshot or IdP report unless the IdP has an API we integrate.
- **Vendor or third-party evidence:** Evidence from SaaS (e.g. GitHub, Slack) may be export or API; we can script it but it’s not in this repo.
- **Narrative and exceptions:** Risk acceptance, scope, and “why we don’t do X” are documented in scorecard, CIS mapping, and architecture; reviewed periodically rather than generated by tooling.

---

## 5. Mapping to the Scorecard and CIS

- **Security scorecard:** For each control, the “Evidence” column should state *how* evidence is automated (e.g. “Config rule,” “Nightly drift workflow,” “SBOM artifact”) and “Last verified” can be “Continuous” when it’s automated.
- **CIS mapping:** The “Evidence / artifact” column in `cis-mapping.md` points to the same automated sources (Config, GuardDuty, Terraform, CI artifacts).

Automation doesn’t change the control—it changes how we **prove** the control is in place and reduces manual evidence collection while keeping evidence current and repeatable.

---

## 6. References

- `cis-mapping.md` — Which controls map to which evidence.
- `security-scorecard.md` — Scorecard format and “Evidence” column.
- `../ci-cd/github-actions/` — Drift, Conftest, Checkov, Trivy, SBOM workflows.
- `../terraform/config-rules/`, `../terraform/org-guardrails/` — Config and GuardDuty as code.
- `../detection-response/` — GuardDuty automation and runbooks.
